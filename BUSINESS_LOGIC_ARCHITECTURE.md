# BUSINESS LOGIC & ARCHITECTURE ANALYSIS

## üéØ –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**OpenAI CLI 2** - —ç—Ç–æ –º–Ω–æ–≥–æ–ø—Ä–æ–≤–∞–π–¥–µ—Ä–Ω–æ–µ CLI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI –º–æ–¥–µ–ª—è–º–∏ (OpenAI, DeepSeek, Anthropic). –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - –ø–µ—Ä–µ–≤–æ–¥—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –∏–∑ SQLite –ë–î.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ bin/app.js (1660 —Å—Ç—Ä–æ–∫) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AIApplication extends Application                            ‚îÇ
‚îÇ  ‚îå‚îÄ –û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ aiState: provider, models, model, selectedProviderKey ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ commandEditor: CommandEditor –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–∞–º–∏ ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ serviceManager: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ simpleCommandHandler: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–º–∞–Ω–¥        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Handlers Chain (DISABLED) - –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞        ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ LEGACY COMMAND SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ MODERN ARCHITECTURE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  config/instructions.js          ‚îÇ    ‚îÇ  services/                    ‚îÇ
‚îÇ  ‚Üì migration.js                  ‚îÇ    ‚îÇ  ‚îú‚îÄ service-manager.js         ‚îÇ
‚îÇ  ‚Üì database-manager.js           ‚îÇ    ‚îÇ  ‚îú‚îÄ ai-provider-service.js     ‚îÇ
‚îÇ  ‚Üì SQLite –ë–î                     ‚îÇ    ‚îÇ  ‚îú‚îÄ command-processing-service ‚îÇ
‚îÇ  ‚Üì commands.db                   ‚îÇ    ‚îÇ  ‚îî‚îÄ input-processing-service   ‚îÇ
‚îÇ  ‚Üì getInstructionsFromDatabase() ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìä –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∞–Ω–¥ (SQLite-based)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥ –≤ –ë–î:
```sql
CREATE TABLE commands (
  id TEXT PRIMARY KEY,           -- ENGLISH, RUSSIAN, HSK, etc.
  key TEXT NOT NULL,            -- JSON array: ["aa", "–∞–∞"]
  description TEXT NOT NULL,    -- "translate into English"
  instruction TEXT NOT NULL,    -- "please provide multiple English..."
  models TEXT DEFAULT NULL,     -- JSON array –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
  cache_enabled INTEGER DEFAULT 1, -- Per-command cache control (1=enabled, 0=disabled)
  created_at INTEGER,
  updated_at INTEGER
)
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- **aa/–∞–∞** ‚Üí ENGLISH: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
- **cc/—Å—Å** ‚Üí CHINESE: –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–∏–π
- **rr** ‚Üí RUSSIAN: –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
- **hsk** ‚Üí HSK: –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ Eng+Ru+Pinyin –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ
- **hskss** ‚Üí HSK_SS: —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º + –ø–µ—Ä–µ–≤–æ–¥
- **gg** ‚Üí GRAMMAR: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏
- **pp/–ø–ø** ‚Üí PINYIN: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–∏–Ω—å–∏–Ω—å
- **tr** ‚Üí TRANSCRIPTION: –∞–Ω–≥–ª–∏–π—Å–∫–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏:
- **cmd/–∫–º–¥** ‚Üí CommandEditor –º–µ–Ω—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ö–æ–º–∞–Ω–¥—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `/config/commands.db` (SQLite)
- –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ `config/instructions.js` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- **Per-command cache control** - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ CommandEditor:
  - Cache enabled/disabled –æ–ø—Ü–∏—è –≤ field selection menu
  - –ö–æ–º–∞–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–µ—à–µ–º
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∫–µ—à –¥–ª—è –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥—ã (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤)

## üé® –ú—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

### –ö–æ–º–∞–Ω–¥—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `rr` —Å 2 –º–æ–¥–µ–ª—è–º–∏):
```
> rr Would you like to update?
[Handler: rr]

DeepSeek (deepseek-chat):
–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π:
*–•–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å?*

–ò–¥–∏–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è / —É—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è:
1. "Would you like to..." ‚Äì –≤–µ–∂–ª–∏–≤–∞—è —Ñ–æ—Ä–º–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–∞ (*—Ö–æ—Ç–µ–ª–∏ –±—ã –≤—ã...*).
   - –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è: /w äd ju la…™k tu/
   - –ê–Ω–∞–ª–æ–≥ –≤ —Ä—É—Å—Å–∫–æ–º: *"–ù–µ —Ö–æ—Ç–∏—Ç–µ –ª–∏...?"*, *"–í–∞–º –Ω–µ —Ö–æ—á–µ—Ç—Å—è...?"* (–º–µ–Ω–µ–µ –±—É–∫–≤–∞–ª—å–Ω—ã–π, –Ω–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç).

*(–¢–µ–∫—Å—Ç –∫–æ—Ä–æ—Ç–∫–∏–π, –ø–æ—ç—Ç–æ–º—É –≤—ã–¥–µ–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.)*
‚úì 11.4s

OpenAI (gpt-5-mini):
–ü–µ—Ä–µ–≤–æ–¥:
- ¬´–•–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å?¬ª (–≤–∞—Ä–∏–∞–Ω—Ç –±–æ–ª–µ–µ –≤–µ–∂–ª–∏–≤—ã–π: ¬´–í—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –æ–±–Ω–æ–≤–∏—Ç—å?¬ª)

–ò–¥–∏–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ:
- "Would you like to..." ‚Äî —É—Å—Ç–æ–π—á–∏–≤–æ–µ –≤–µ–∂–ª–∏–≤–æ–µ –æ–±–æ—Ä–æ—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —á—Ç–æ‚Äë–ª–∏–±–æ —Å–¥–µ–ª–∞—Ç—å/–ø–æ–ª—É—á–∏—Ç—å. –ü–µ—Ä–µ–≤–æ–¥: ¬´–•–æ—Ç–∏—Ç–µ...¬ª, ¬´–í—ã —Ö–æ—Ç–µ–ª–∏ –±—ã...¬ª.
  –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è/—Å–≤–æ–±–æ–¥–Ω–∞—è): /w äd j…ô la…™k t…ô/
  –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (—á–∏—Å—Ç–∞—è —Ñ–æ—Ä–º–∞): /w äd juÀê la…™k tuÀê/

–û—Ç–¥–µ–ª—å–Ω–æ —Å–ª–æ–≤–æ:
- "update" ‚Äî –≥–ª–∞–≥–æ–ª ¬´–æ–±–Ω–æ–≤–∏—Ç—å¬ª.
  –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è: / åpÀàde…™t/

[2/2 models responded in 12.8s]
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:**
- `[Handler: rr]` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏: `DeepSeek (deepseek-chat):` –∏ `OpenAI (gpt-5-mini):`
- Timing –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏: `‚úì 11.4s`
- –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞: `[2/2 models responded in 12.8s]`
- –†–µ–∞–ª—Ç–∞–π–º streaming - –æ—Ç–≤–µ—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

## üéØ –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –º—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:
- ‚úÖ **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è** - –∫–µ—à –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–µ–º `cache_enabled` –≤ –ë–î
- **–ö–µ—à –æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π** –∫–æ–º–∞–Ω–¥—ã - –æ–¥–∏–Ω –∫–µ—à-–∫–ª—é—á –¥–ª—è –≤—Å–µ–≥–æ –º—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- **–ö–ª—é—á –∫–µ—à–∞** = —á–∏—Å—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –ë–ï–ó –∫–æ–º–∞–Ω–¥—ã-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è LLM
- **–ü—Ä–∏–º–µ—Ä –∫–ª—é—á–∞**: `"–∫–∞–∫ –¥–µ–ª–∞?"` (–ù–ï `"–ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π: –∫–∞–∫ –¥–µ–ª–∞?"`)
- **–ö–µ—à –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –ø–æ–ª–Ω—ã–π –º—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Å–æ –≤—Å–µ–º–∏ –º–æ–¥–µ–ª—è–º–∏
- **Force flags** (`-f`, `--force`) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –∫–µ—à
- **Per-command control**: –ª—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–æ–¥—ã) –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –°—Ç—Ä–∏–º–∏–Ω–≥ –º—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:
- ‚úÖ **Leaderboard system** - –º–æ–¥–µ–ª–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ "–∫—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏–ª"
- ‚úÖ **Real-time —Å—Ç—Ä–∏–º–∏–Ω–≥** –æ—Ç —Å–∞–º–æ–π –±—ã—Å—Ç—Ä–æ–π –º–æ–¥–µ–ª–∏ (–ø–µ—Ä–≤–æ–π –≤ leaderboard)
- ‚úÖ **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**:
  - –ü–æ–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –º–æ–¥–µ–ª—å –ø–æ —á–∞–Ω–∫–∞–º, –≤—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø–æ—á—Ç–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
  - –ï—Å–ª–∏ –≤—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `done` ‚Üí –≤—ã–≤–æ–¥–∏—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
  - –ï—Å–ª–∏ –≤—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–∞ ‚Üí –≤—ã–≤–æ–¥–∏—Ç—å "—á—Ç–æ —É–∂–µ –ø—Ä–∏—à–ª–æ" —Å—Ä–∞–∑—É + –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —á–∞–Ω–∫–∞–º
- ‚úÖ **–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏** –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
- ‚úÖ **–ó–∞–≥–æ–ª–æ–≤–∫–∏** —Å –∏–º–µ–Ω–∞–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ—Ç–≤–µ—Ç–æ–º
- ‚úÖ **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞** = —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (leaderboard)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≤–æ–¥–∞:
```
> rr –∫–∞–∫ –¥–µ–ª–∞?
[Handler: rr]

DeepSeek (deepseek-chat):    ‚Üê –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–≤–æ–π (—Å–∞–º–æ–π –±—ã—Å—Ç—Ä–æ–π) –º–æ–¥–µ–ª–∏
[real-time streaming]        ‚Üê —Å—Ç—Ä–∏–º–∏–Ω–≥ –ø–æ —á–∞–Ω–∫–∞–º
‚úì 11.4s                     ‚Üê timing –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏

OpenAI (gpt-5-mini):        ‚Üê –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏  
[–ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É]        ‚Üê –µ—Å–ª–∏ done, –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–π + —Å—Ç—Ä–∏–º–∏–Ω–≥
[2/2 models responded in 12.8s] ‚Üê —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –º—É–ª—å—Ç–∏–º–æ–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö:
- ‚úÖ –ï—Å–ª–∏ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –ø–∞–¥–∞–µ—Ç ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É + –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏
- ‚úÖ –ï—Å–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø–∞–¥–∞—é—Ç ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –æ–±—â—É—é –æ—à–∏–±–∫—É
- ‚úÖ Partial success ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã + –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üîÑ –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

### 1. –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª (AIApplication.run):
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞:
- –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ prompt
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞ (–∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ AI-–∑–∞–ø—Ä–æ—Å)
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ AI –∑–∞–ø—Ä–æ—Å–æ–≤ (processAIInput):

#### 2.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞:
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–∞—Ä–∫–µ—Ä–∞ `$$` –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –≤–≤–æ–¥–µ –∏ –∑–∞–º–µ–Ω—è–µ—Ç –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ä–∞–∑–º–µ—Ä–∞.

#### 2.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ force flags:
–î–µ—Ç–µ–∫—Ü–∏—è —Ñ–ª–∞–≥–æ–≤ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`--force`, `-f`) –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫–µ—à–∞ –∏ –∏—Ö —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞.

#### 2.3 –ü–æ–∏—Å–∫ –∫–æ–º–∞–Ω–¥—ã –≤ –ë–î:
–ü–æ–∏—Å–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### 2.4 MCP –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å URL):
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–µ–±-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–ª–∏ –ø–æ–∏—Å–∫–∞ –∏ –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤.

#### 2.5 –ö—ç—à –ø—Ä–æ–≤–µ—Ä–∫–∞:
- **Multi-provider –∫–æ–º–∞–Ω–¥—ã**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- **Translation –∫–æ–º–∞–Ω–¥—ã**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ –∫–ª—é—á—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

#### 2.6 –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞:

**Multi-model processing**: –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**Single provider processing**: 
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ –∫–ª—é—á—É
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ ServiceManager
- –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Ç–æ–∫–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
- –û—Ç–≤–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è StreamProcessor –¥–ª—è real-time –≤—ã–≤–æ–¥–∞

## üéõÔ∏è –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –º–æ–¥–µ–ª–∏

### –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
- **OpenAI** (GPT-4, GPT-3.5, gpt-5-mini)
- **DeepSeek** (deepseek-chat)
- **Anthropic** (Claude 3.5 Sonnet, Haiku, Opus)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø**: Legacy State –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Modern ServiceManager –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

### –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
- ‚úÖ **Instant switching** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∑–∞ ~0.016ms
- ‚úÖ **Lazy loading** - –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- ‚úÖ **provider: null** - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ (–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ)
- ‚úÖ **selectedProviderKey** - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ AIProcessor
- ‚úÖ **Fallback —Å–∏—Å—Ç–µ–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
1. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ** —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `provider`
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (403, region block)
3. **Fallback —Ü–µ–ø–æ—á–∫–∞**: openai ‚Üí anthropic ‚Üí deepseek

## üåê MCP (Model Context Protocol) –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ MCP –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- **URL detection**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤–µ–±-—Å—Å—ã–ª–æ–∫
- **Search intent**: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Routing**: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É MCP —Å–µ—Ä–≤–µ—Ä—É (fetch/web-search)

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ MCP —Å–µ—Ä–≤–µ—Ä—ã:
- **fetchMCPServer**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü
- **searchMCPServer**: –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ DuckDuckGo API

## üõ†Ô∏è –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### User-Friendly Error Handling:
–í–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö stack trace –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:

```
‚ùå Provider not working: deepseek
Would you like to switch to another provider? (y/n): 
```

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:

1. **–î–µ—Ç–µ–∫—Ü–∏—è –æ—à–∏–±–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
2. **User-friendly —Å–æ–æ–±—â–µ–Ω–∏–µ**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä**: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
4. **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**: –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
5. **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:
- ‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –∫—Ä–∞—à–µ–π** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–º
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - –¥–∏–∞–ª–æ–≥ —Å AI –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- ‚úÖ **Graceful degradation** - –µ—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, —á–µ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
1. **–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
2. **API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–º–µ–Ω—ã)
3. **–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á** - –ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—á–µ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
4. **–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç** - rate limiting (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–æ–∂–¥–∞—Ç—å –∏–ª–∏ —Å–º–µ–Ω–∏—Ç—å)

## üîß –ö–ª—é—á–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã

### StreamProcessor:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–º–µ–Ω—ã (Escape key)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à:
–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏:
- **Escape key**: –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ Processing**: –æ—Ç–º–µ–Ω–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ Typing**: –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞
- **Return to prompt**: –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –≤–≤–æ–¥—É

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã–º –≤–≤–æ–¥–æ–º:
**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- **–ü–µ—Ä–≤–æ–µ –ø—É—Å—Ç–æ–µ –Ω–∞–∂–∞—Ç–∏–µ Enter**: –æ—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞ —Å AI
- **–í—Ç–æ—Ä–æ–µ –ø—É—Å—Ç–æ–µ –Ω–∞–∂–∞—Ç–∏–µ Enter**: –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —ç–∫—Ä–∞–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –¥–ª—è "—á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞"
- –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±—ã—Å—Ç—Ä–æ "–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å" —Å–µ—Å—Å–∏—é –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∏–ª –¥–∏–∞–ª–æ–≥ —Å AI
2. –ù–∞–∂–∏–º–∞–µ—Ç Enter –ø—Ä–∏ –ø—É—Å—Ç–æ–º –≤–≤–æ–¥–µ ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω, –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
3. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —á–∏—Å—Ç—ã–π —ç–∫—Ä–∞–Ω ‚Üí –µ—â–µ —Ä–∞–∑ Enter –ø—Ä–∏ –ø—É—Å—Ç–æ–º –≤–≤–æ–¥–µ ‚Üí —ç–∫—Ä–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UX:**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ readline (CLIManager) 
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –≤–≤–æ–¥–µ
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- **Per-command control**: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ `cache_enabled` –ø–æ–ª–µ
- **–ü–µ—Ä–µ–≤–æ–¥—ã**: –ø–æ –∫–ª—é—á—É –∑–∞–ø—Ä–æ—Å–∞ (–µ—Å–ª–∏ cache_enabled=true)
- **Multi-provider**: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–µ—Å–ª–∏ cache_enabled=true)  
- **–î–æ–∫—É–º–µ–Ω—Ç—ã**: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã
- **TTL caching** —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π (30 –¥–Ω–µ–π)
- **CommandEditor integration**: –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–µ—à–∞ —á–µ—Ä–µ–∑ UI
- **Force override**: —Ñ–ª–∞–≥–∏ `-f` –∏–ª–∏ `--force` –æ–±—Ö–æ–¥—è—Ç –∫–µ—à –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫

### ‚ö†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:
**–ù–ê–†–£–®–ï–ù–ò–ï Single Source of Truth** - –ª–æ–≥–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–∞ –ø–æ 5 —Ñ–∞–π–ª–∞–º:
1. `cache-handler.js` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω–æ –ª–∏ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å
2. `AIProcessor.js` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cache_enabled –∏ –≤—ã–∑—ã–≤–∞–µ—Ç cache.set()  
3. `RequestRouter.js` - –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∫–µ—à–∞ —Å TTL 30s
4. `Application.js` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cache_enabled –≤ –¥—Ä—É–≥–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
5. `stream-handler.js` - –µ—â–µ –æ–¥–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ cache_enabled

**–¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** –≤ centralized `CacheManager` –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã.

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 1. Dual Architecture (Legacy + Modern):
–°–æ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –Ω–æ–≤—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞:
- **Legacy**: –ø—Ä—è–º–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å aiState –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **Modern**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ServiceManager –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### 2. Command Pattern:
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø–æ —Ç–∏–ø–∞–º –∏ –æ–±–ª–∞—Å—Ç—è–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
- **Core commands**: —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (help, exit)
- **AI commands**: –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –∏ –º–æ–¥–µ–ª—è–º–∏
- **Instruction commands**: –∫–æ–º–∞–Ω–¥—ã –∏–∑ SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 3. Factory Pattern:
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

### 4. Chain of Responsibility (DISABLED):
–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–∞—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–∞—è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **bin/app.js**: –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (1660 —Å—Ç—Ä–æ–∫) —Å –ø–æ–ª–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
- **utils/application.js**: –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å Application —Å –æ–±—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
- **utils/command-manager.js**: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–∞–º–∏
- **utils/provider-factory.js**: –§–∞–±—Ä–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **utils/stream-processor.js**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **utils/database-manager.js**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SQLite –±–∞–∑–æ–π –∫–æ–º–∞–Ω–¥
- **utils/migration.js**: –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –≤ –±–∞–∑—É
- **utils/command-editor.js**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–º–∞–Ω–¥
- **services/service-manager.js**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–µ—Ä–≤–∏—Å-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **config/instructions.js**: Legacy –∫–æ–º–∞–Ω–¥—ã (–º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è –≤ –ë–î)
- **config/api_providers.js**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- **config/commands.db**: SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
- **config/mcp-servers.json**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
- **config/default_models.js**: –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **config/constants.js**: –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ UI —Å–∏–º–≤–æ–ª—ã

## üöÄ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **SQLite –∫–æ–º–∞–Ω–¥—ã**: aa, cc, rr, hsk –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ –ë–î
2. **Multi-provider –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: OpenAI, DeepSeek, Anthropic —Å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
3. **MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–µ–±-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
4. **Streaming**: –ø–æ—Ç–æ–∫–æ–≤—ã–π –≤—ã–≤–æ–¥ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–µ—Ä–µ–≤–æ–¥—ã –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
6. **CommandEditor**: –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏
7. **Robust Error Handling**: user-friendly –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –±–µ–∑ –∫—Ä–∞—à–µ–π
8. **Instant Provider Switching**: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (~0.016ms)
9. **Graceful Recovery**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–º–µ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### üîÑ –ü–µ—Ä–µ—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
1. **Dual architecture**: Legacy + Modern —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
2. **Handler Chain**: –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω, –Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω
3. **ServiceManager**: —á–∞—Å—Ç–∏—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:
- **–§–∞–∑–∞ 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞**: –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥ —É–¥–∞–ª–µ–Ω, —Ç–µ—Å—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã
- **–§–∞–∑–∞ 2 –≥–æ—Ç–æ–≤–∞**: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–∑—É—á–µ–Ω–∞, —Ç–æ—á–∫–∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- **Core –ø–æ–Ω–∏–º–∞–Ω–∏–µ**: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

## üîç –ö–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –§–∞–∑—ã 2

### –§–∞–π–ª—ã –¥–ª—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏:
1. **bin/app.js:549-1129** ‚Üí `processAIInput` (580 —Å—Ç—Ä–æ–∫)
2. **bin/app.js:44-85** ‚Üí `AIApplication constructor` 
3. **bin/app.js:246-327** ‚Üí `registerAICommands`
4. **bin/app.js:1541-1641** ‚Üí `main run loop`

### –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–∏–µ:
- `core/StateManager.js` ‚Üê aiState + contextHistory
- `core/CLIInterface.js` ‚Üê readline, terminal, keypress  
- `core/RequestRouter.js` ‚Üê processAIInput –ª–æ–≥–∏–∫–∞
- `commands/CommandExecutor.js` ‚Üê command execution logic

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö–æ—Ä–æ—à–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ—Ç–∫–æ–º—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–ª–∏—á–∏—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.